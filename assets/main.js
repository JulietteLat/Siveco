//SIVECO
mapboxgl.accessToken = 'pk.eyJ1IjoianVsaWV0dGVsYXQiLCJhIjoiY2szNDFleWJzMHNjOTNtczJrc3pwMjR5bCJ9.IvgBC4cXDgWfBYunhdqh5w';

//current teams affectations geojson file
  var current_factories = {
   "type": "FeatureCollection",
   "features": [
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.46742,22.339452 ]
    },
    "properties": {
    "indice":1,
    "nid":197389,
    "team_nid":197428,
    "team_indice":6
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.210212,22.642108 ]
    },
    "properties": {
    "indice":2,
    "nid":197386,
    "team_nid":197425,
    "team_indice":5
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.214201,22.649341 ]
    },
    "properties": {
    "indice":3,
    "nid":197387,
    "team_nid":197425,
    "team_indice":5
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.261396,22.711603 ]
    },
    "properties": {
    "indice":4,
    "nid":197384,
    "team_nid":197424,
    "team_indice":4
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.258406,22.688569 ]
    },
    "properties": {
    "indice":5,
    "nid":197385,
    "team_nid":197424,
    "team_indice":4
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.304946,22.616003 ]
    },
    "properties": {
    "indice":6,
    "nid":197382,
    "team_nid":197423,
    "team_indice":3
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.303676,22.617108 ]
    },
    "properties": {
    "indice":7,
    "nid":197383,
    "team_nid":197423,
    "team_indice":3
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.32456,22.420834 ]
    },
    "properties": {
    "indice":8,
    "nid":197381,
    "team_nid":197422,
    "team_indice":2
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.331531,22.393117 ]
    },
    "properties": {
    "indice":9,
    "nid":249934,
    "team_nid":197422,
    "team_indice":2
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.368723,22.540675 ]
    },
    "properties": {
    "indice":10,
    "nid":330949,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.377756,22.505842 ]
    },
    "properties": {
    "indice":11,
    "nid":330948,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.358295,22.539625 ]
    },
    "properties": {
    "indice":12,
    "nid":330958,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.355869,22.541343 ]
    },
    "properties": {
    "indice":13,
    "nid":330952,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.411437,22.540141 ]
    },
    "properties": {
    "indice":14,
    "nid":330947,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.416199,22.506047 ]
    },
    "properties": {
    "indice":15,
    "nid":330942,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.376439,22.503142 ]
    },
    "properties": {
    "indice":16,
    "nid":330939,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.40762,22.547184 ]
    },
    "properties": {
    "indice":17,
    "nid":330946,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.40724,22.542584 ]
    },
    "properties": {
    "indice":18,
    "nid":330945,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.355119,22.543449 ]
    },
    "properties": {
    "indice":19,
    "nid":330959,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.371258,22.478039 ]
    },
    "properties": {
    "indice":20,
    "nid":330975,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.43494,22.535997 ]
    },
    "properties": {
    "indice":21,
    "nid":330974,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.375794,22.55114 ]
    },
    "properties": {
    "indice":22,
    "nid":367083,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.450846,22.51568 ]
    },
    "properties": {
    "indice":23,
    "nid":330978,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.352,22.4584 ]
    },
    "properties": {
    "indice":24,
    "nid":330970,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.365758,22.490336 ]
    },
    "properties": {
    "indice":25,
    "nid":330963,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.370254,22.54625 ]
    },
    "properties": {
    "indice":26,
    "nid":330960,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.374666,22.499024 ]
    },
    "properties": {
    "indice":27,
    "nid":330966,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.373629,22.496089 ]
    },
    "properties": {
    "indice":28,
    "nid":330965,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.354422,22.515466 ]
    },
    "properties": {
    "indice":29,
    "nid":197371,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.439423,22.513377 ]
    },
    "properties": {
    "indice":30,
    "nid":197370,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.43696,22.513043 ]
    },
    "properties": {
    "indice":31,
    "nid":197369,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.353492,22.517992 ]
    },
    "properties": {
    "indice":32,
    "nid":197372,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.375505,22.501189 ]
    },
    "properties": {
    "indice":33,
    "nid":197375,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.361458,22.541661 ]
    },
    "properties": {
    "indice":34,
    "nid":197374,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.356932,22.546358 ]
    },
    "properties": {
    "indice":35,
    "nid":197373,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.397331,22.541959 ]
    },
    "properties": {
    "indice":36,
    "nid":197364,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.385329,22.557079 ]
    },
    "properties": {
    "indice":37,
    "nid":197363,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.37008,22.509586 ]
    },
    "properties": {
    "indice":38,
    "nid":197362,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.42157,22.520277 ]
    },
    "properties": {
    "indice":39,
    "nid":197365,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.426321,22.52564 ]
    },
    "properties": {
    "indice":40,
    "nid":197368,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.412912,22.532338 ]
    },
    "properties": {
    "indice":41,
    "nid":197367,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.413154,22.522315 ]
    },
    "properties": {
    "indice":42,
    "nid":197366,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.376396,22.55201 ]
    },
    "properties": {
    "indice":43,
    "nid":330931,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.402147,22.544501 ]
    },
    "properties": {
    "indice":44,
    "nid":330929,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.399608,22.536482 ]
    },
    "properties": {
    "indice":45,
    "nid":330928,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.370426,22.513229 ]
    },
    "properties": {
    "indice":46,
    "nid":330935,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.416794,22.527527 ]
    },
    "properties": {
    "indice":47,
    "nid":330938,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.370296,22.549457 ]
    },
    "properties": {
    "indice":48,
    "nid":330937,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.375164,22.509915 ]
    },
    "properties": {
    "indice":49,
    "nid":330936,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.367099,22.478767 ]
    },
    "properties": {
    "indice":50,
    "nid":197378,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.366524,22.487747 ]
    },
    "properties": {
    "indice":51,
    "nid":197377,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.370533,22.493307 ]
    },
    "properties": {
    "indice":52,
    "nid":197376,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.458969,22.5176 ]
    },
    "properties": {
    "indice":53,
    "nid":197379,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.369689,22.551344 ]
    },
    "properties": {
    "indice":54,
    "nid":330927,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.403992,22.553931 ]
    },
    "properties": {
    "indice":55,
    "nid":330926,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.440958,22.525391 ]
    },
    "properties": {
    "indice":56,
    "nid":197380,
    "team_nid":197421,
    "team_indice":1
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.371193,22.506306 ]
    },
    "properties": {
    "indice":57,
    "nid":330967,
    "team_nid":0,
    "team_indice":0
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.357301,22.485119 ]
    },
    "properties": {
    "indice":58,
    "nid":330962,
    "team_nid":0,
    "team_indice":0
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.362431,22.519384 ]
    },
    "properties": {
    "indice":59,
    "nid":330957,
    "team_nid":0,
    "team_indice":0
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.368328,22.505713 ]
    },
    "properties": {
    "indice":60,
    "nid":330973,
    "team_nid":0,
    "team_indice":0
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.360234,22.492065 ]
    },
    "properties": {
    "indice":61,
    "nid":330971,
    "team_nid":0,
    "team_indice":0
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.362174,22.500012 ]
    },
    "properties": {
    "indice":62,
    "nid":330969,
    "team_nid":0,
    "team_indice":0
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.364614,22.549125 ]
    },
    "properties": {
    "indice":63,
    "nid":330953,
    "team_nid":0,
    "team_indice":0
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.435854,22.504831 ]
    },
    "properties": {
    "indice":64,
    "nid":330941,
    "team_nid":0,
    "team_indice":0
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.4336,22.50519 ]
    },
    "properties": {
    "indice":65,
    "nid":330940,
    "team_nid":0,
    "team_indice":0
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.375991,22.544239 ]
    },
    "properties": {
    "indice":66,
    "nid":330932,
    "team_nid":0,
    "team_indice":0
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.374591,22.553853 ]
    },
    "properties": {
    "indice":67,
    "nid":330951,
    "team_nid":0,
    "team_indice":0
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.375843,22.554129 ]
    },
    "properties": {
    "indice":68,
    "nid":330950,
    "team_nid":0,
    "team_indice":0
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.43323,22.508342 ]
    },
    "properties": {
    "indice":69,
    "nid":330944,
    "team_nid":0,
    "team_indice":0
    }
  },
  {
   "type": "Feature",
   "geometry": {
        "type": "Point",
        "coordinates":  [ 113.39842, 22.51444 ]
    },
    "properties": {
    "indice":70,
    "nid":"origin",
    "team_nid":"all",
    "team_indice":"0"
    }
  }
]
};
//end of geojson file

//current teams affectations geojson file
  var algo_factories = {
   "type": "FeatureCollection",
   "features": [
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.46742,22.339452 ]
    },
    "properties": {
    "team_indice":8,
    "nid":197389,
    "work_capacity":4423
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.365758,22.490336 ]
    },
    "properties": {
    "team_indice":7,
    "nid":330963,
    "work_capacity":17909
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.366524,22.487747 ]
    },
    "properties": {
    "team_indice":7,
    "nid":197377,
    "work_capacity":17909
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.368328,22.505713 ]
    },
    "properties": {
    "team_indice":7,
    "nid":330973,
    "work_capacity":17909
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.375164,22.509915 ]
    },
    "properties": {
    "team_indice":7,
    "nid":330936,
    "work_capacity":17909
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.352,22.4584 ]
    },
    "properties": {
    "team_indice":7,
    "nid":330970,
    "work_capacity":17909
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.32456,22.420834 ]
    },
    "properties": {
    "team_indice":7,
    "nid":197381,
    "work_capacity":17909
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.331531,22.393117 ]
    },
    "properties": {
    "team_indice":7,
    "nid":249934,
    "work_capacity":17909
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.43494,22.535997 ]
    },
    "properties": {
    "team_indice":7,
    "nid":330974,
    "work_capacity":17909
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.385329,22.557079 ]
    },
    "properties": {
    "team_indice":6,
    "nid":197363,
    "work_capacity":15405
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.304946,22.616003 ]
    },
    "properties": {
    "team_indice":6,
    "nid":197382,
    "work_capacity":15405
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.303676,22.617108 ]
    },
    "properties": {
    "team_indice":6,
    "nid":197383,
    "work_capacity":15405
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.258406,22.688569 ]
    },
    "properties": {
    "team_indice":6,
    "nid":197385,
    "work_capacity":15405
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.261396,22.711603 ]
    },
    "properties": {
    "team_indice":6,
    "nid":197384,
    "work_capacity":15405
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.214201,22.649341 ]
    },
    "properties": {
    "team_indice":6,
    "nid":197387,
    "work_capacity":15405
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.210212,22.642108 ]
    },
    "properties": {
    "team_indice":6,
    "nid":197386,
    "work_capacity":15405
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.403992,22.553931 ]
    },
    "properties": {
    "team_indice":5,
    "nid":330926,
    "work_capacity":17728
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.402147,22.544501 ]
    },
    "properties": {
    "team_indice":5,
    "nid":330929,
    "work_capacity":17728
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.397331,22.541959 ]
    },
    "properties": {
    "team_indice":5,
    "nid":197364,
    "work_capacity":17728
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.399608,22.536482 ]
    },
    "properties": {
    "team_indice":5,
    "nid":330928,
    "work_capacity":17728
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.40724,22.542584 ]
    },
    "properties": {
    "team_indice":5,
    "nid":330945,
    "work_capacity":17728
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.40762,22.547184 ]
    },
    "properties": {
    "team_indice":5,
    "nid":330946,
    "work_capacity":17728
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.411437,22.540141 ]
    },
    "properties": {
    "team_indice":5,
    "nid":330947,
    "work_capacity":17728
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.385329,22.557079 ]
    },
    "properties": {
    "team_indice":5,
    "nid":197363,
    "work_capacity":17728
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.376396,22.55201 ]
    },
    "properties": {
    "team_indice":4,
    "nid":330931,
    "work_capacity":17898
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.375843,22.554129 ]
    },
    "properties": {
    "team_indice":4,
    "nid":330950,
    "work_capacity":17898
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.374591,22.553853 ]
    },
    "properties": {
    "team_indice":4,
    "nid":330951,
    "work_capacity":17898
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.375991,22.544239 ]
    },
    "properties": {
    "team_indice":4,
    "nid":330932,
    "work_capacity":17898
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.370254,22.54625 ]
    },
    "properties": {
    "team_indice":4,
    "nid":330960,
    "work_capacity":17898
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.364614,22.549125 ]
    },
    "properties": {
    "team_indice":4,
    "nid":330953,
    "work_capacity":17898
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.356932,22.546358 ]
    },
    "properties": {
    "team_indice":4,
    "nid":197373,
    "work_capacity":17898
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.355119,22.543449 ]
    },
    "properties": {
    "team_indice":4,
    "nid":330959,
    "work_capacity":17898
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.355869,22.541343 ]
    },
    "properties": {
    "team_indice":4,
    "nid":330952,
    "work_capacity":17898
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.368723,22.540675 ]
    },
    "properties": {
    "team_indice":4,
    "nid":330949,
    "work_capacity":17898
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.370426,22.513229 ]
    },
    "properties": {
    "team_indice":3,
    "nid":330935,
    "work_capacity":17985
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.362431,22.519384 ]
    },
    "properties": {
    "team_indice":3,
    "nid":330957,
    "work_capacity":17985
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.353492,22.517992 ]
    },
    "properties": {
    "team_indice":3,
    "nid":197372,
    "work_capacity":17985
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.354422,22.515466 ]
    },
    "properties": {
    "team_indice":3,
    "nid":197371,
    "work_capacity":17985
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.361458,22.541661 ]
    },
    "properties": {
    "team_indice":3,
    "nid":197374,
    "work_capacity":17985
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.358295,22.539625 ]
    },
    "properties": {
    "team_indice":3,
    "nid":330958,
    "work_capacity":17985
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.370296,22.549457 ]
    },
    "properties": {
    "team_indice":3,
    "nid":330937,
    "work_capacity":17985
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.369689,22.551344 ]
    },
    "properties": {
    "team_indice":3,
    "nid":330927,
    "work_capacity":17985
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.375794,22.55114 ]
    },
    "properties": {
    "team_indice":3,
    "nid":367083,
    "work_capacity":17985
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.367099,22.478767 ]
    },
    "properties": {
    "team_indice":2,
    "nid":197378,
    "work_capacity":17728
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.371258,22.478039 ]
    },
    "properties": {
    "team_indice":2,
    "nid":330975,
    "work_capacity":17728
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.360234,22.492065 ]
    },
    "properties": {
    "team_indice":2,
    "nid":330971,
    "work_capacity":17728
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.362174,22.500012 ]
    },
    "properties": {
    "team_indice":2,
    "nid":330969,
    "work_capacity":17728
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.371193,22.506306 ]
    },
    "properties": {
    "team_indice":2,
    "nid":330967,
    "work_capacity":17728
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.376439,22.503142 ]
    },
    "properties": {
    "team_indice":2,
    "nid":330939,
    "work_capacity":17728
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.377756,22.505842 ]
    },
    "properties": {
    "team_indice":2,
    "nid":330948,
    "work_capacity":17728
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.375505,22.501189 ]
    },
    "properties": {
    "team_indice":2,
    "nid":197375,
    "work_capacity":17728
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.374666,22.499024 ]
    },
    "properties": {
    "team_indice":2,
    "nid":330966,
    "work_capacity":17728
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.373629,22.496089 ]
    },
    "properties": {
    "team_indice":2,
    "nid":330965,
    "work_capacity":17728
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.37008,22.509586 ]
    },
    "properties": {
    "team_indice":2,
    "nid":197362,
    "work_capacity":17728
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.362431,22.519384 ]
    },
    "properties": {
    "team_indice":2,
    "nid":330957,
    "work_capacity":17728
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.413154,22.522315 ]
    },
    "properties": {
    "team_indice":1,
    "nid":197366,
    "work_capacity":17957
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.416794,22.527527 ]
    },
    "properties": {
    "team_indice":1,
    "nid":330938,
    "work_capacity":17957
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.412912,22.532338 ]
    },
    "properties": {
    "team_indice":1,
    "nid":197367,
    "work_capacity":17957
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.426321,22.52564 ]
    },
    "properties": {
    "team_indice":1,
    "nid":197368,
    "work_capacity":17957
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.42157,22.520277 ]
    },
    "properties": {
    "team_indice":1,
    "nid":197365,
    "work_capacity":17957
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.435854,22.504831 ]
    },
    "properties": {
    "team_indice":1,
    "nid":330941,
    "work_capacity":17957
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.43323,22.508342 ]
    },
    "properties": {
    "team_indice":1,
    "nid":330944,
    "work_capacity":17957
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.439423,22.513377 ]
    },
    "properties": {
    "team_indice":1,
    "nid":197370,
    "work_capacity":17957
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.43696,22.513043 ]
    },
    "properties": {
    "team_indice":1,
    "nid":197369,
    "work_capacity":17957
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.440958,22.525391 ]
    },
    "properties": {
    "team_indice":1,
    "nid":197380,
    "work_capacity":17957
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.458969,22.5176 ]
    },
    "properties": {
    "team_indice":1,
    "nid":197379,
    "work_capacity":17957
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.450846,22.51568 ]
    },
    "properties": {
    "team_indice":1,
    "nid":330978,
    "work_capacity":17957
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.416199,22.506047 ]
    },
    "properties": {
    "team_indice":1,
    "nid":330942,
    "work_capacity":17957
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.4336,22.50519 ]
    },
    "properties": {
    "team_indice":1,
    "nid":330940,
    "work_capacity":17957
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.370533,22.493307 ]
    },
    "properties": {
    "team_indice":1,
    "nid":197376,
    "work_capacity":17957
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.357301,22.485119 ]
    },
    "properties": {
    "team_indice":1,
    "nid":330962,
    "work_capacity":17957
    }
  },
  {
    "type": "Feature",
    "geometry": {
       "type": "Point",
       "coordinates":  [ 113.371258,22.478039 ]
    },
    "properties": {
    "team_indice":1,
    "nid":330975,
    "work_capacity":17957
    }
  },
   {
   "type": "Feature",
   "geometry": {
        "type": "Point",
        "coordinates":  [ 113.39842, 22.51444 ]
    },
    "properties": {
    "team_indice":0,
    "nid":"origin",
    "work_capacity":0
    }
  }
]
};
//end of geojson file

//the followig block determines colors attributed to teams
teams_colors = {"1": 'rgba(94,170,188,0.9)', 
"2": "rgba(98,97,148,0.9)", 
"3": "rgba(182,162,217,0.9)",
"4": "rgba(94,161,215,0.9)",
"5": "rgba(83,202,191,0.9)",
"6": "rgba(116,112,206,0.9)",
"7": "rgba(125,81,221,0.9)"
};

//the following block displays mapbox map
var map = new mapboxgl.Map({  
container: 'map', 
style: 'mapbox://styles/juliettelat/ck3pf0oj06p9l1crutxskznmt',
center: [113.32174,22.517012], 
zoom: 9.8
});


///////////////DATASET SELECTION/////////////////////////////////////////////////////////////////////////////////////

//builds a bridge between map and data

var factories = algo_factories;
var button_current = document.getElementById('button-current');
    button_current.addEventListener('click', function () {
      console.log ('current clicked successfully');
      var factories = current_factories;
      console.log(factories);
    });
var button_algo = document.getElementById('button-algo');
    button_algo.addEventListener('click', function () {
      console.log ('algo clicked successfully');
      var factories = algo_factories;
      console.log(factories);
    })
console.log(factories);
console.log('test');

  map.on ('load', function () {



    map.addSource('factories', {
        "type": "geojson",
        "data": factories
    });



  /*
      var factories = 
  });*/


  ///////////////MAP LAYERS/////////////////////////////////////////////////////////////////////////////////////

    map.addLayer({
      'id':'factories',
      'type': 'circle',
      'source': 'factories',
      //'source-layer': 'original', CETTE LIGNE FAIT BUGUER
      'paint': {
        // make circles larger as the user zooms from z12 to z22
        'circle-radius': {
        'base': 0,
        'stops': [ [11, 3], [12, 4], [14, 6], [16, 8], [18, 12]]
        },
        //color all circles in white
        'circle-color': 'rgba(170, 170, 170, 0.6)',
      }
    },
    );

  //adds a layer that displays highlighted factories when a factory is clicked
    map.addLayer({
      'id': 'factories-highlighted',
      'type': 'circle',
      'source': 'factories',
      //'source-layer': 'original', ENCORE LA LIGNE DU DEMON
      'paint':{
        'circle-radius': {
        'base': 0,
        'stops': [ [11, 4], [12, 5], [14, 7], [16, 9], [18, 13]]
        },
       // 'circle-color':'rgba(0, 200, 255, 0.9)',
        'circle-color': [
        'match',
        ['get', 'team_indice'],
        "1", teams_colors["1"], 
        "2", teams_colors["2"], 
        "3", teams_colors["3"],
        "4", teams_colors["4"],
        "5", teams_colors["5"],
        "6", teams_colors["6"],
        "7", teams_colors["7"],
         /*  other */ 'rgba(0, 200, 255, 0.9)'
        ]    
      },
      'filter': ['in', 'team_indice', '']
    });

    //adds a layer that displays highlighted factories when a factory is clicked
    map.addLayer({
      'id': 'unique-factory',
      'type': 'circle',
      'source': 'factories',
      //'source-layer': 'original', ENCORE LA LIGNE DU DEMON
      'paint':{
        'circle-radius': {
        'base': 0,
        'stops': [ [11, 4], [12, 5], [14, 7], [16, 9], [18, 13]]
        },
       // 'circle-color':'rgba(0, 200, 255, 0.9)',
        'circle-color': 'rgba(255, 0, 0, 0.9)',   
      },
      'filter': ['in', 'nid', '']
    });

  ///////////////INTERACTIVE MAP/////////////////////////////////////////////////////////////////////////////////////

    //highlights factories that are visited by the same teams than the clicked point on the map
    map.on('click', 'factories', function(e) {
      menuFact.style.display = "none"; //removes factories list
      var feature = e.features[0];
      //actualizes the unique-factory filter
      map.setFilter('unique-factory', ['in', 'nid', '']); //empty filter
      map.setFilter ('unique-factory', ['in', 'nid', feature.properties.nid]); //refill filter
      //actualizes the factories-highlighted filter
      map.setFilter('factories-highlighted', ['in', 'team_indice', '']); //empty filter
      var featuresgroup = map.querySourceFeatures ('factories', {  
        sourceLayer: 'factories',
        filter: ['in', 'nid', feature.properties.nid]
      }); //creates an array with all factories with same nid (features of the same factory visited by several teams)
      var filter = featuresgroup.reduce(
        function(memo, feature) {
        memo.push(feature.properties.team_indice);
        return memo;
        }, //creates a group with all the factories visited by the same teams as the factory selected
      ['in', 'team_indice']
      );
      map.setFilter('factories-highlighted', filter); //refill filter
    });

    map.on('mouseleave', 'factories', function() {
      map.getCanvas().style.cursor = '';
    });

    map.on('mousemove', 'factories', function() {
      map.getCanvas().style.cursor = 'pointer';
    });

  ///////////////INTERACTIVE LIST/////////////////////////////////////////////////////////////////////////////////////

  // Create a popup, but don't add it to the map yet.
  var popup = new mapboxgl.Popup({
    closeButton: false
  });
   
  var listingEl = document.getElementById('teams-listing');
  var listingFact = document.getElementById('factories-listing');
  var menuFact = document.getElementsByClassName('factories-menu')[0];
   
  function renderListings (features) {
    //DISPLAYS TEAM LIST
    listingEl.innerHTML = ''; //clear team list
    if (features.length) {
      var i;
      var rank = features.length - 1;
      var imax = features[rank].properties.team_indice; //puts the number of teams in the dataset in the variable imax
      for (i = 0; i <= imax; i++) { //diplays the list
        if (i == 0) {
          var item = document.createElement('a');
              item.textContent = 'No affectation 0';   
          listingEl.appendChild(item);       
        }
        else {
          var item = document.createElement('a');
              item.textContent = 'Team ' + i;
          listingEl.appendChild(item);
        }
        item.addEventListener('click', function renderListings () {
          //DISPLAYS HIGLIGHTED DOTS ON THE MAP WHEN TEAM LIST IS CLICKED ON
            map.setFilter('factories-highlighted', ['in', 'team_indice', '']); //empty filter
            map.setFilter('unique-factory', ['in', 'nid', '']); //empty filter
            var j = parseInt (event.target.firstChild.textContent.slice(-1),10) ; //gets the team number from the button
            map.setFilter ('factories-highlighted', ['in', 'team_indice', j]); //refill filter
          //DISPLAYS THE FACTORIES LIST WHEN A TEAM IS CLICKED ON
            //menuFact = '';
            console.log(menuFact);
            menuFact.style.display = "block"; //displays html factory list background
            listingFact.innerHTML = ''; //clear factory list
              features.forEach(function(feature) {
              if (feature.properties.team_indice == j) { //pour enlever le if, d'abord sélectionner les j, ensuite les afficher
                var itemFact = document.createElement('a');
                    itemFact.textContent = 'factory ' + feature.properties.nid;
                listingFact.appendChild(itemFact);
                  itemFact.addEventListener('click', function renderListings () {
                //HIGHLIGHTS THE FACTORY ON THE MAP WHEN FACTORY LIST IS CLICKED ON
                  map.setFilter('unique-factory', ['in', 'nid', '']); //empty filter
                  map.setFilter ('unique-factory', ['in', 'nid', feature.properties.nid]); //refill filter
              });
              }
            });
        });
      };
    }
  }
        


  /*function renderListings (features) {
    // Clear any existing listings
    listingEl.innerHTML = '';
    if (features.length) {
      features.forEach(function(feature, index) {
        //console.log(index); permet de voir dans la console les valeurs que prend index
        var prop = feature.properties;
        if (index == 0) {
          var item = document.createElement('a');
              item.textContent = 'Team :' + prop.team_nid;
          var item2 = document.createElement('a');
              item2.textContent =  'factory ' + prop.nid;    
          listingEl.appendChild(item);
          listingEl.appendChild(item2);        
        }
        else {
          //console.log(index-1);
          if (prop.team_nid !== features[index-1].properties.team_nid ) { 
            var item = document.createElement('a');
                item.textContent =  'Team ' + prop.team_nid;
            var item2 = document.createElement('a');
                item2.textContent =  'factory ' + prop.nid;
            listingEl.appendChild(item);
            listingEl.appendChild(item2);
          }
          else { 
            var item2 = document.createElement('a');
            item2.textContent =  'factory ' + prop.nid;
            listingEl.appendChild(item2);
          }
        }
        item2.addEventListener('click', function() {
          //vide le filtre précédent
          map.setFilter('factories-highlighted', ['in', 'team_indice', '']);
          // factories.getFeatureByProperty = function(feature.properties.nid);
          // the fisrt filter gets all the factories with the same nid
          // in case a factory is visited by more than one team
          var j = 330944;
            //var featuresgroup = map.querySourceFeatures ('factories', {
              //sourceLayer: 'factories',
              //filter: ['==', 'nid', feature.properties.nid]
            //});
          //console.log (featuresgroup);

          map.setFilter ('factories-highlighted', ['in', 'nid', j]);
          // The second filter gets all the factories that are visited 
          // by the same teams than the factory in the featuresgroup filter
            //var filter = featuresgroup.reduce(
            //  function(memo, feature) {
            //    memo.push(feature.properties.team_indice);
            //    return memo;
            //  },
            //  ['in', 'team_indice']
            //);
            //console.log (filter);
            //map.setFilter('factories-highlighted', filter);
          //Displays POPUP when mouse clicks a list element
            //popup
            //  .setLngLat(feature.geometry.coordinates)
            //  .setText(prop.nid + ': team' + prop.team_nid)
            //  .addTo(map);
          });
      });
    }
  }*/

    map.on('click', function() {
      var features = map.queryRenderedFeatures({ layers: ['factories'] });
      //Populate features for the listing overlay.
      renderListings(features);
    });
  });



